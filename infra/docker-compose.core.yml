networks:
  cortex_prime_network:
    driver: bridge
    name: cortex_prime_network

services:
  api_gateway:
    build:
      context: ../services/api_gateway
      dockerfile: Dockerfile
    container_name: cortex-prime_api_gateway_mk1
    restart: unless-stopped
    ports:
      - "${GATEWAY_HOST_PORT:-8080}:8080"
    networks:
      - cortex_prime_network
    depends_on:
      - chimera_core
    volumes:
      - ../services/api_gateway:/app:rw
    env_file:
      - ../.env

  chimera_core:
    build:
      context: ../services/chimera_core
      dockerfile: Dockerfile
    container_name: cortex-prime_chimera_core_mk1
    restart: unless-stopped
    ports: # Exposing this is useful for direct debugging
      - "${CHIMERA_CORE_HOST_PORT:-8001}:8001"
    networks:
      - cortex_prime_network
    volumes:
      - ../services/chimera_core:/app:rw
      - ../agents:/app/agents:ro
    env_file:
      - ../.env

  web_client:
    image: nginx:alpine
    container_name: cortex-prime_web_client_mk1
    restart: unless-stopped
    ports:
      - "${WEB_CLIENT_HOST_PORT:-8889}:80"
    volumes:
      - ../services/web_client/index.html:/usr/share/nginx/html/index.html:ro
      - ../services/web_client/style.css:/usr/share/nginx/html/style.css:ro
      - ../services/web_client/client.js:/usr/share/nginx/html/client.js:ro
      - ../services/web_client/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    networks:
      - cortex_prime_network
